---
title: "CoC Criminal Survey Analysis"
author: "Theresa Diffendal"
updated: "3/25/2020"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This rMarkdown file analyzes criminal charges related to homelessness in 11 states and the District of Columbia as collected by students in Deborah Nelson's JOUR698I class at the University of Maryland's Philip Merrill College of Journalism's Howard Center for Investigative Journalism. Cities in each of the states were examined and codified by whether the law applied to the whole city (written as "citywide"), only applied to particular places ("particular_places"), there was no law ("none"), or the law was unclear ("unclear"). Laws were not examined for every city in each state; cities were examined based on the focus of the class' investigation. 

The acronym CoC will be used to mean Continuum of Care, which are citywide or regional areas across which housing and services for the homeless are coordinated. Read more about CoCs [here](https://www.hudexchange.info/programs/coc/).

```{r, warning=FALSE, message=FALSE, echo=FALSE}
## Read in data and clean

##Libraries

#update.packages()
#install.packages("knitr")

library(knitr)
library(tidyverse)
library(janitor)
library(lubridate)
library(ggplot2)
library(dplyr)
library(stringr)
library(kableExtra)

## Set working directory
setwd("~/GitHub/homelessness-in-the-us/coc-crim-survey")

crim_survey <- read_csv("coc-crim-survey.csv") %>%
  ##only select rows with data
  
  ##rename the columns
  rename("name" = "coc-crim-",
         "coc" = X2,
         "city" = X3,
         "public_sleeping_law"  = X10,
         "public_sleeping_link" = X11,
         "public_camping_law" = X13,
         "public_camping_link" = X14,
         "public_sitting_law" = X16,
         "public_sitting_link" = X17,
         "vehicle_living_law" = X19,
         "vehicle_living_link" = X20,
         "loitering_law" = X22,
         "loitering_link" = X23,
         "begging_law" = X25,
         "begging_link" = X26,
         "food_sharing_law" = X28,
         "food_sharing_link" = X29,
         "public_urination_law" = X31,
         "public_urination_link" = X32,
         "public_intoxication_law" = X34,
         "public_intoxication_link" = X35,
         "misc_law" = X37,
         "misc_link" = X38) %>%
  
  ##clean column names
  clean_names() %>%
  ##change all observations to lower case
  mutate_all(funs(tolower))


crim_survey <- crim_survey %>%
  ##create columns to summarize how many laws are citywide, particular, none or unclear in each row
  mutate(citywide = rowSums(crim_survey == "citywide", na.rm=TRUE),   
         particular_places = rowSums(crim_survey == "only in particular places", na.rm=TRUE),
         none = rowSums(crim_survey == "none", na.rm=TRUE),
         unclear = rowSums(crim_survey == "unclear", na.rm=TRUE)) %>%
  
  ##get rid of columns we don't need to analyze
  filter(complete == "yes",
         coc != "state") %>%
  select(-name, -complete, -new_reporting_or_nlchp_fact_check, -c3, -meet_definition, -contains ("link"), -contains("law")) %>%
  ##reorder columns with mutated columns first
  select(3,1,2,13:16,4:12)
```

## Overall Law Information

Most of the laws examined are applicable across the city (195), which is only slightly greater than the amount of laws that are not on the books (174). Together, "citywide" and "none" account for over 70% of the laws examined, with 38.1% and 39%, respectively. 20% of laws are only applicable in particular places while 7.6% of the laws were unclear.

While laws applicable in particular places represent a fifth of the laws examined, the majority of the time it appears that laws either apply citywide or do not exist.

```{r}
overall_laws <- crim_survey %>%
  select(citywide, particular_places, unclear, none) %>%
  colSums() %>%
  as.data.frame(, keep.rownames=TRUE) %>%
  tibble::rownames_to_column() %>%
  rename("count" = ".") %>%
  mutate(pct = (count / sum(count))*100) 

print(overall_laws)

#YOURE BEAUTIFUL
```

## State and City Information

* 11 states are examined: Alaska, California, Florida, Hawaii, Kentucky, Louisiana, Massachusetts, Maryland, New York, North Carolina, and Oregon; and the District of Columbia.
* Number of cities examined in each state:
  + Alaska - 1
  + California - 20
  + The District of Columbia - 1
  + Florida - 17
  + Hawaii - 2
  + Kentucky - 1
  + Louisiana - 1
  + Massachusetts - 5
  + Maryland - 3
  + Missouri - 1
  + Nevada - 1
  + New York - 1
  + North Carolina - 1
  + Oregon - 3

```{r}
#Get the abbreviations of all examined states
states <- as.vector(crim_survey$state)
print(unique(states))
```

```{r}
# See how many states there are; answer: 13 + D.C.
length(unique(states))
```

```{r}
#How many cities were analyzed in each state
crim_survey_states <- crim_survey %>%
  group_by(state) %>%
  summarise(city_count=n())
print(crim_survey_states)
```

```{r}
# See each city examined in each state
crim_survey_cities <- crim_survey %>%
  group_by(state) %>%
  select(state, city) %>%
  arrange(state)

## all the kable code creates an interactive, scrollable table in the .html output
kable(crim_survey_cities) %>%
  column_spec(2, border_left = T, border_right = F) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "250px")
```

## Continuum of Care Analysis

* California CoC Oakland/Alameda has the greatest number of laws that disproportionately affect homeless individuals with 19. Florida's CoC consisting of Fort Pierce/St. Lucie/Indian River/Martin Counties is a close second with 17 laws.
* CoCs in California and Florida also have the second fewest laws that mostly impact homeless individuals. Amador/Calaveras/Tuolumne/Mariposa and Humboldt County CoCs in California and Columbia/Hamilton/Lafayette/Suwanee Coc in Florida only have 2 laws.
* A Massachusettes CoC, Worcester, has only 1 law. It outlaws begging citywide.

```{r}
## create new data set
coc_totals <- crim_survey %>%
  
  ## group by coc so totals are by coc
  group_by(coc) %>%
  
  ## sum all indications that a law exists (so not including none or unclear)
  summarise(total_laws = sum(citywide + particular_places)) %>%
  
  ## get rid of other columns
  select(coc, total_laws) %>%
  
  ## put the coc with the most laws first
  arrange(desc(total_laws))

kable(coc_totals) %>%
  column_spec (2:ncol(coc_totals),border_left = T, border_right = F) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "300px")
```

## City Analysis

* The cities of Waldorf, Md. and Worcester, Mass. have the fewest laws with only 1. Lake City, Ione and Eureka round out the bottom five with two laws each.
* Oakland has the most with 9 laws. This means that Oakland has every possible examined law on the books.
* No state has eight laws, but 10 states have seven laws.

```{r}
## create new data set
city_totals <- crim_survey %>%
  
  ## group by state so totals are by state
  group_by(city) %>%
  
  ## sum all indications that a law exists (so not including none or unclear)
  summarise(total_laws = sum(citywide + particular_places),
            "citywide"=citywide, 
            "particular_places"=particular_places, 
            "unclear"=unclear, 
            "none"=none) %>%
  
  ## put the state with the most laws first
  arrange(desc(total_laws))

kable(city_totals) %>%
  column_spec (2:ncol(city_totals),border_left = T, border_right = F) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "250px")
```

## Which state has the most laws?

* California comes in first with 110 laws and is the only examined state with over 100 laws.
* Alaska and Kentucky have the fewest laws with only 4
* The top six states - California, Florida, Massachusetts, Oregon, Hawaii and Maryland - were the only states in which more than one CoC was examined.

```{r}
## create new data set
state_totals <- crim_survey %>%
  
  ## group by state so totals are by state
  group_by(state) %>%
  
  ## sum all indications that a law exists (so not including none or unclear)
  summarise(total_laws = sum(citywide + particular_places)) %>%
  
  ## get rid of other columns
  select(state, total_laws) %>%
  
  ## put the state with the most laws first
  arrange(desc(total_laws))

kable(state_totals) %>%
  column_spec (2:ncol(state_totals),border_left = T, border_right = F) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "250px")
```

## Types of Laws by State

**Notes:**

* There are more citywide laws than any other kind (195), followed by no law (174), particular places (104) and unclear (39)
* Fifity percent of less of the laws in 10 of the 14 states (and DC) analyzed are citywide.
* California and Florida had the most citywide laws with 77 and 44, respectively
  + Note that California and Florida had more analyzed cities than other states
* Almost 40% of all citywide laws examined are in California
* Hawaii had the lowest percentage citywide laws, accounting for only 3 (16.7%) of the 18 HI laws recorded
  + Hawaii also had the most "unclear" laws, accounting for seven (27.8%) of its examined laws
* Over half (55.56%) of the examined laws in New York are only applicable in particular places. Over in Louisiana, 44.4% of the laws cover a particular place.
* Massachusetts has no laws only applicable in particular places. The state's laws are citywide or non-existant. 

```{r}

#bind all the state analyses together
all_state <- crim_survey %>%
  
  #louisiana massachusetts
  
  #only select the columns with sums and calculations
  select(c(1,3:7)) %>%
  
  #group by state in this dataset instead of city in the previous sets
  group_by(state) %>%
  
  #sum the number of citywide, particular, none, and unclear laws for each state
  summarise(sum_state_citywide = sum(citywide),
            sum_state_particular_places = sum(particular_places),
            sum_state_none = sum(none),
            sum_state_unclear = sum(unclear)) 

all_state <- all_state %>%
  
  #calculate what percentage of the state's laws are citywide, particular, none, unclear
  mutate(percent_state_citywide = (sum_state_citywide / rowSums(all_state[,c(2:5)]) * 100),
         percent_state_particular_places = (sum_state_particular_places / rowSums(all_state[,c(2:5)]) * 100),
         percent_state_none = (sum_state_none / rowSums(all_state[,c(2:5)]) * 100),
         percent_state_unclear = (sum_state_unclear / rowSums(all_state[,c(2:5)]) * 100)) %>%
  
  #calculate each state's share of the total citywide, particular, unclear, none laws in the sheet
  mutate(percent_all_citywide = (sum_state_citywide / sum(sum_state_citywide) * 100),
         percent_all_particular_places = (sum_state_particular_places / sum(sum_state_particular_places) * 100),
         percent_all_none = (sum_state_none / sum(sum_state_none) * 100),
         percent_all_unclear = (sum_state_unclear / sum(sum_state_unclear) * 100)) %>%

  #add a row with totals
  janitor::adorn_totals("row")

kable(all_state) %>%
  column_spec (2:ncol(all_state),border_left = T, border_right = F) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "300px")

```


```{r, include=FALSE}
## Write csv files for all state summaries
#setwd("~/Documents/GitHub/homelessness-in-the-us/coc-crim-survey")
#write.csv(alaska, "alaska-summary.csv")
#write.csv(california, "california-summary.csv")
#write.csv(dc, "dc-summary.csv")
#write.csv(florida, "florida-summary.csv")
#write.csv(hawaii, "hawaii-summary.csv")
#write.csv(kentucky, "kentucky-summary.csv")
#write.csv(louisiana, "louisiana-summary.csv")
#write.csv(maryland, "maryland-summary.csv")
#write.csv(massachusetts, "massachusetts-summary.csv")
#write.csv(new_york, "new-york-summary.csv")
#write.csv(north_carolina, "north-carolina-summary.csv")
#write.csv(oregon, "oregon-summary.csv")
```
